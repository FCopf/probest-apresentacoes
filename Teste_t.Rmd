---
title: "Inferência Estatística"
subtitle: "O teste t de *Student*"
author: "Fabio Cop (fabiocopf@gmail.com)"
institute: "Instituto do Mar - UNIFESP"
date: "Última atualização em `r format(Sys.time(), '%d de %B de %Y')`"
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts]
    lib_dir: libs
    nature:
      highlightStyle: arta
      highligthLines: true
      countIncrementalSlides: false
      ratio: "16:9"
---

```{r setup-chunk, include=FALSE, message = FALSE, echo = FALSE, warning = FALSE}
options(
  htmltools.dir.version = FALSE,
  html.preserve.raw = FALSE # needed for windows
)

# chunk options
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

# Packages
suppressMessages(library(tidyverse))
suppressMessages(library(kableExtra))

# Functions
source('r_functions/auxiliary_fun.r', encoding = "UTF-8")

```

``` {css, echo =F} 
    .pull-left-min {
      float: left;
      width: 70%;
    }

    .pull-right-min {
      float: right;
      width: 27%;
    }
    
    .golden-jackals {
      background-image: url('img/Golden_jackals.jpg');
      background-size: 30%;
      background-position: left bottom;
    }

```

```{r xaringan-scribble, echo=FALSE}
xaringanExtra::use_scribble()
```
---

# Conteúdo da aula

___

1. Distribuição $t$ de *Student*

1. Estatística $t$ *versus* Estatística $z$: aumento dos graus de liberdade

1. Teste $t$ para uma média amostral

1. Teste $t$ para duas médias independentes
  
  - Teste $t$ variâncias homogêneas
  
  - Teste $t$ de Welch para variâncias heterogêneas

1. Teste $t$ pareado para duas médias dependentes

___

---

# Distribuição *t* de Student: Biometrika. 1908, vol. 6, 1-15

.pull-left-min[

```{r, out.width="90%", fig.align = 'center'}
knitr::include_graphics("img/Student_1908_first_paragf.png")
```

]

.pull-right-min[

```{r, out.width="70%", fig.align = 'rigth', fig.cap = 'William Sealy Gosset (1876 - 1937)'}
knitr::include_graphics("img/William_Sealy_Gosset.jpg")
```

]

---

# Distribuição *t* de Student: Biometrika. 1908, vol. 6, 1-15

> O Teorema Central do Limite garante que a distribuição de $\overline{X}$ tende à normalidade à medida que $n$ aumenta.

> No entanto, para amostras pequenas a distribuição t de Student fornece uma aproximação melhor para a distribuição das médias amostrais.

```{r, out.width="90%", fig.align = 'center'}
knitr::include_graphics("img/Stutents_t_distribution.png")
```

---

# Distribuição *t* de Student: Biometrika. 1908, vol. 6, 1-15

```{r, out.width="90%", fig.align = 'center'}
knitr::include_graphics("img/Z_vs_T_distribution.png")
```

---

class: center

# Distribuição *t* de Student: Biometrika. 1908, vol. 6, 1-15


.pull-left[

*Distribuição t*

```{r, fig.height=6, fig.width=7.0}
plt_dt_fun(gl = 4, fill_area = 'outer',
           alpha_sl = 0.05, alternative = 'two-sided',
           label_limits = 'numeric',
           from_alpha = TRUE)$plt
```


]

.pull-right[

*Distribuição Normal Padronizada*

```{r, fig.height=6, fig.width=7.0}
plt_norm_fun(alpha_sl = 0.05,
             distribution = 'Z',
             fill_area = 'outer',
             alternative = 'two-sided',
             label_limits = 'numeric',
             from_alpha = TRUE)$plt
```

]

---

class: center

# Distribuição *t* de Student: Biometrika. 1908, vol. 6, 1-15


.pull-left[

*Distribuição t*

```{r, fig.height=6, fig.width=7.0}
plt_dt_fun(gl = 30, fill_area = 'outer',
           alpha_sl = 0.05, alternative = 'two-sided',
           label_limits = 'numeric',
           from_alpha = TRUE)$plt
```


]

.pull-right[

*Distribuição Normal Padronizada*

```{r, fig.height=6, fig.width=7.0}
plt_norm_fun(alpha_sl = 0.05,
             distribution = 'Z',
             fill_area = 'outer',
             alternative = 'two-sided',
             label_limits = 'numeric',
             from_alpha = TRUE)$plt

```

]

---

class: center

# Distribuição *t* de Student: Biometrika. 1908, vol. 6, 1-15


.pull-left[

*Distribuição t*

```{r, fig.height=6, fig.width=7.0}
plt_dt_fun(gl = 100, fill_area = 'outer',
           alpha_sl = 0.05, alternative = 'two-sided',
           label_limits = 'numeric',
           from_alpha = TRUE)$plt
```


]

.pull-right[

*Distribuição Normal Padronizada*

```{r, fig.height=6, fig.width=7.0}
plt_norm_fun(alpha_sl = 0.05,
             distribution = 'Z',
             fill_area = 'outer',
             alternative = 'two-sided',
             label_limits = 'numeric',
             from_alpha = TRUE)$plt

```

]

---

# Teste $t$ para uma média amostral

#### A diversidade média de peixes em riachos costeiros de Mata Atlântica tem distribuição normal com $\mu = 2.65$. Você dispõe de amostras para 10 riachos que obtidas na década de 70. Com estas amostras, deseja testar se houve mudança na diversidade média ao longo dos últimos 50 anos.

___

```{r}
set.seed(839)
n <- 10
mu <- 2.65
amostra  <- round(rnorm(n = n, mean = mu, sd = 0.5),2)
dp <- sd(amostra)
ep <- dp/sqrt(n)
tc <- (mean(amostra) - mu)/ep
teste_t <- t.test(amostra, mu = mu, alternative = 'two.sided')

fig_teste <- plt_dt_fun(gl = n-1, tc = tc,
           alternative = 'two-sided',
           fill_area = 'outer',
           label_limits = 'numeric',
           from_alpha = FALSE)
p_valor <- fig_teste$area_lower + fig_teste$area_lower

```

.pull-left[

#### Hipóteses estatísticas

$H_0: \mu = 2.65$ (Hipótese nula)

$H_a: \mu \ne 2.65$ (Hipótese alternativa)

$\alpha = 0.05$ (nível de significância)

```{r}
kableExtra::kbl(matrix(amostra, nrow = 2), col.names = NA, caption  = 'Diversidade nos riachos')
```

]

.pull-right[

A média amostral nos `r n` riachos: 

$\overline{X} = \frac{\sum{X_i}}{n} = `r round(mean(amostra),2)`$

com erro padrão de:

$s_{\overline{X}} = \frac{s}{\sqrt{n}} = \frac{`r round(dp,2)`}{`r round(sqrt(n),2)`} = `r round(ep,2)`$

e um valor de $t_{calculado}$:

$t_c = \frac{\overline{X} - \mu}{s_{\overline{X}}} = \frac{`r round(mean(amostra),2)` - `r mu`}{`r round(ep,2)`} = `r round(tc,2)`$


]

---

# Teste $t$ para uma média amostral

#### A diversidade média de peixes em riachos costeiros de Mata Atlântica tem distribuição normal com $\mu = 2.65$. Você dispõe de amostras para 10 riachos que obtidas na década de 70. Com estas amostras, deseja testar se houve mudança na diversidade média ao longo dos últimos 50 anos.

___

.pull-left[

#### Hipóteses estatísticas

$H_0: \mu = 2.65$ (Hipótese nula)

$H_a: \mu \ne 2.65$ (Hipótese alternativa)

$\alpha = 0.05$ (nível de significância)

Utilizando a Tabela t, encontramos a probabilidade de obtermos valores tão ou mais extremos que $-`r round(tc,2)`$ e $+`r round(tc,2)`$.

]

.pull-right[


#### Segundo $H_0$

```{r, fig.height=5, fig.width=6.0}
fig_teste$plt
```

]

---

# Teste $t$ para uma média amostral

#### A diversidade média de peixes em riachos costeiros de Mata Atlântica tem distribuição normal com $\mu = 2.65$. Você dispõe de amostras para 10 riachos que obtidas na década de 70. Com estas amostras, deseja testar se houve mudança na diversidade média ao longo dos últimos 50 anos.

___

.pull-left[

#### Hipóteses estatísticas

$H_0: \mu = 2.65$ (Hipótese nula)

$H_a: \mu \ne 2.65$ (Hipótese alternativa)

$\alpha = 0.05$ (nível de significância)

##### Média da amostra

$\overline{X} = `r round(mean(amostra),2)`$

]

.pull-right[

##### Resultado do teste

$p = `r fig_teste['area_lower']` + `r fig_teste['area_upper']` = `r p_valor`$

___

Como $`r p_valor`$ > $0.05$ 

**Aceito** $H_0$ e concluo que:

> Não há evidências na amostra que me permita dizer que a diversidade há 50 anos fosse diferente da diversidade atual.

]

---

class: code70

# Teste $t$ para uma média amostral

#### A diversidade média de peixes em riachos costeiros de Mata Atlântica tem distribuição normal com $\mu = 2.65$. Você dispõe de amostras para 10 riachos que obtidas na década de 70. Com estas amostras, deseja testar se houve mudança na diversidade média ao longo dos últimos 50 anos.

___

amostra: `r paste(amostra, collapse = ", ")`

```{r, include = TRUE, echo = TRUE}
t.test(amostra, mu = 2.65, alternative = "two.sided")

```


---

# Teste $t$ para uma média amostral

#### (TESTE **UNICAUDAL**) A diversidade média de peixes em riachos costeiros de Mata Atlântica tem distribuição normal com $\mu = 2.65$. Você supõe que na década de 70 a diversidade fosse **maior** que atualmente devido a fatores como desmatamento e aumento na ocupação urbana ao longo dos últimos 50 anos.

___

```{r}
fig_teste_uni <- plt_dt_fun(gl = n-1, tc = tc,
           alternative = 'upper',
           fill_area = 'outer',
           label_limits = 'numeric',
           from_alpha = FALSE)
p_valor_uni <- fig_teste_uni$area_upper

```

.pull-left[

#### Hipóteses estatísticas

$H_0: \mu = 2.65$ (Hipótese nula)

$H_a: \mu > 2.65$ (Hipótese alternativa)

$\alpha = 0.05$ (nível de significância)

```{r}
kableExtra::kbl(matrix(amostra, nrow = 2), col.names = NA, caption  = 'Diversidade nos riachos')
```

]

.pull-right[

A média amostral nos `r n` riachos: 

$\overline{X} = \frac{\sum{X_i}}{n} = `r round(mean(amostra),2)`$

com erro padrão de:

$s_{\overline{X}} = \frac{s}{\sqrt{n}} = \frac{`r round(dp,2)`}{`r round(sqrt(n),2)`} = `r round(ep,2)`$

e um valor de $t_{calculado}$:

$t_c = \frac{\overline{X} - \mu}{s_{\overline{X}}} = \frac{`r round(mean(amostra),2)` - `r mu`}{`r round(ep,2)`} = `r round(tc,2)`$


]

---

# Teste $t$ para uma média amostral

#### (TESTE **UNICAUDAL**) A diversidade média de peixes em riachos costeiros de Mata Atlântica tem distribuição normal com $\mu = 2.65$. Você supõe que na década de 70 a diversidade fosse **maior** que atualmente devido a fatores como desmatamento e aumento na ocupação urbana ao longo dos últimos 50 anos.

___

.pull-left[

#### Hipóteses estatísticas

$H_0: \mu = 2.65$ (Hipótese nula)

$H_a: \mu > 2.65$ (Hipótese alternativa)

$\alpha = 0.05$ (nível de significância)

Utilizando a Tabela t, encontramos a probabilidade de obtermos valores tão ou mais extremos que $+`r round(tc,2)`$.

]

.pull-right[


#### Segundo $H_0$

```{r, fig.height=5, fig.width=6.0}
fig_teste_uni$plt
```

]

---

# Teste $t$ para uma média amostral

#### (TESTE **UNICAUDAL**) A diversidade média de peixes em riachos costeiros de Mata Atlântica tem distribuição normal com $\mu = 2.65$. Você supõe que na década de 70 a diversidade fosse **maior** que atualmente devido a fatores como desmatamento e aumento na ocupação urbana ao longo dos últimos 50 anos.

___

.pull-left[

#### Hipóteses estatísticas

$H_0: \mu = 2.65$ (Hipótese nula)

$H_a: \mu > 2.65$ (Hipótese alternativa)

$\alpha = 0.05$ (nível de significância)

##### Média da amostra

$\overline{X} = `r round(mean(amostra),2)`$

]

.pull-right[

##### Resultado do teste

$p = `r p_valor_uni`$

___

Como $`r p_valor_uni` \le 0.05$ 

**Rejeito** $H_0$ e concluo que:

> Há evidências na amostra para dizer que a diversidade há 50 anos era **maior** que diversidade atual.

```{r, fig.height=5, fig.width=6.0}
#fig_teste$plt
```

]

---

class: code70

# Teste $t$ para uma média amostral

#### (TESTE **UNICAUDAL**) A diversidade média de peixes em riachos costeiros de Mata Atlântica tem distribuição normal com $\mu = 2.65$. Você supõe que na década de 70 a diversidade fosse **maior** que atualmente devido a fatores como desmatamento e aumento na ocupação urbana ao longo dos últimos 50 anos.

___

amostra: `r paste(amostra, collapse = ", ")`

```{r, echo = TRUE}
t.test(amostra, mu = 2.65, alternative = "greater")
```

---

class: golden-jackals, left

# Teste $t$ para duas amostras independentes

```{r}
jackal <- read.csv('datasets/jackal.csv', sep = ';', header = TRUE)
jackal_larger <- jackal %>%
  mutate(ID = rep(1:10, times = 2),.before = Comprimento) %>% 
  spread(key = Sexo, value = Comprimento)

medias <- jackal_larger %>% 
  summarize(Femea = mean(Femea), Macho  = mean(Macho))

medias <- jackal_larger %>% 
  summarize(Femea = mean(Femea), Macho  = mean(Macho))
desvio <- jackal_larger %>% 
  summarize(Femea = sd(Femea), Macho  = sd(Macho)) %>% 
  round(.,2)

n <- nrow(jackal_larger)

```


### Existe evidência de que o tamanho das mandíbulas de Chacais dourados seja diferente em machos e fêmeas?

.pull-left[

#### Hipóteses estatísticas

$H_0: \mu_{macho} = \mu_{fêmea}$

$H_a: \mu_{macho} \ne \mu_{fêmea}$

$\alpha = 0.05$

]



.pull-right[

```{r}
jackal_larger %>% 
  t() %>% 
  kbl() %>%
  kable_classic(full_width = F, html_font = "Cambria", font_size = 15)
```


$\overline{X}_{fêmea} = `r medias['Femea']`$; $\overline{X}_{macho} = `r medias['Macho']`$

$s_{fêmea} = `r desvio['Femea']`$; $s_{macho} = `r desvio['Macho']`$

$n_{fêmea} = n_{macho} = `r nrow(jackal_larger)`$

]


---

class: golden-jackals, left

# Teste $t$ para duas amostras independentes

### Existe evidência de que o tamanho das mandíbulas de Chacais dourados seja diferente em machos e fêmeas?

.pull-left[

#### Hipóteses estatísticas

$H_0: \mu_{macho} = \mu_{fêmea}$

$H_a: \mu_{macho} \ne \mu_{fêmea}$

$\alpha = 0.05$

]



.pull-right[

```{r}
# jackal_larger %>% 
#   t() %>% 
#   kbl() %>%
#   kable_classic(full_width = F, html_font = "Cambria", font_size = 12)
```


##### 1. Variância conjunta

$s_{p}^{2} = \frac{\sum{(X_{i,f} - \overline{X}_f)^2} + \sum{(X_{i,m} - \overline{X}_m)^2}}{(n_f - 1) + (n_m - 1)}$

##### 2. Erro padrão da diferença de médias

$s_{\overline{X}_f - \overline{X}_m} = \sqrt{\frac{s_{p}^{2}}{n_f} + \frac{s_{p}^{2}}{n_m}}$

##### 3. Estatística $t$

$t_c = \frac{\overline{X}_f - \overline{X}_m}{s_{\overline{X}_f - \overline{X}_m}}$

]

---

class: golden-jackals, left

# Teste $t$ para duas amostras independentes

### Existe evidência de que o tamanho das mandíbulas de Chacais dourados seja diferente em machos e fêmeas?

.pull-left[

#### Hipóteses estatísticas

$H_0: \mu_{macho} = \mu_{fêmea}$

$H_a: \mu_{macho} \ne \mu_{fêmea}$

$\alpha = 0.05$

]



.pull-right[

```{r}
jackal_larger %>%
  t() %>%
  kbl() %>%
  kable_classic(full_width = F, html_font = "Cambria", font_size = 15)

sXXf2 <- sum((jackal_larger$Femea - medias$Femea)^2)
sXXm2 <- sum((jackal_larger$Macho - medias$Macho)^2)
sp <- (sXXf2 + sXXm2) / ((n - 1) + (n - 1))
epsp <- sqrt(2 * (sp/n))
tc_jc <- (medias$Femea - medias$Macho)/epsp
```


##### 1. Variância conjunta

$s_{p}^{2} = \frac{`r round(sXXf2,2)` + `r round(sXXm2,2)`}{`r n - 1` + `r n - 1`} = `r round(sp,2)`$

##### 2. Erro padrão da diferença de médias

$s_{\overline{X}_f - \overline{X}_m} = \sqrt{\frac{`r round(sp,2)`}{`r n`} + \frac{`r round(sp,2)`}{`r n`}} = `r round(epsp,2)`$

##### 3. Estatística $t$

$t_c = \frac{`r round(medias['Femea'],2)` - `r round(medias['Femea'],2)`}{`r round(epsp,2)`} = `r round(tc_jc,2)`$

]

---

class: left

# Teste $t$ para duas amostras independentes

### Existe evidência de que o tamanho das mandíbulas de Chacais dourados seja diferente em machos e fêmeas?

.pull-left[

```{r}
ttest_jackal <- t.test(jackal_larger$Femea, jackal_larger$Macho, 
                       alternative = 'two.sided', 
                       var.equal = TRUE)

curv_jac <- plt_dt_fun(gl = ttest_jackal$parameter, fill_area = 'outer',
           alternative = 'two-sided',
           label_limits = 'numeric',
           from_alpha = FALSE, tc = tc_jc)

p_valor_jac <- curv_jac$area_lower + curv_jac$area_upper

```


$\overline{X}_{fêmea} = `r medias['Femea']`$; $\overline{X}_{macho} = `r medias['Macho']`$

##### Resultado do teste

$p = `r curv_jac['area_lower']` + `r curv_jac['area_upper']` = `r p_valor_jac`$

**Rejeito** $H_0$ e concluo que:

> **Há evidências** na amostra para assumir que existem diferenças no comprimento médio entre machos e fêmeas. O comprimento da mandíbula das fêmeas é, em média, $`r abs(medias$Femea - medias$Macho)`$ mm  menor.

]


.pull-right[

```{r, fig.height=6, fig.width=7.0}
curv_jac$plt
```

]

---

class: code70

# Teste $t$ para duas amostras independentes

### Existe evidência de que o tamanho das mandíbulas de Chacais dourados seja diferente em machos e fêmeas?

.pull-left[

```{r, include = TRUE, echo = TRUE}
t.test(Comprimento ~ Sexo, data = jackal, 
                       alternative = 'two.sided', 
                       var.equal = TRUE)

```

]

.pull-right[

```{r}
jackal %>%
  kbl() %>%
  kable_classic(full_width = F, html_font = "Cambria", font_size = 11)
```


]

---

class: left

# Teste $t$ para duas amostras independentes

### Pressupostos

1. Amostras independentes;

1. A população de origem tem distribuição Normal;

1. As variâncias populacionais de fêmeas e machos são **homogêneas**, $\sigma_{fêmea}^2 = \sigma_{macho}^2$.

```{r, out.width="70%", fig.align = 'center'}
knitr::include_graphics("img/pressupostos_t.png")
```